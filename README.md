# RAG 기반 주식 분석 시스템

RAG(Retrieval-Augmented Generation) 기술을 활용한 고도화된 주식 분석 시스템입니다. 한국 주식 시장 데이터를 실시간으로 수집하고, AI 기반 분석을 통해 투자 인사이트를 제공합니다.

## 주요 기능

### 데이터 수집 및 분석
- **실시간 한국 주식 데이터 수집** (pykrx 활용)
- **고급 기술적 지표 계산**
  - 이동평균선 (SMA 5, 10, 20일)
  - MACD 및 Signal Line
  - RSI(14) 지표
  - 볼린저 밴드
  - 스토캐스틱 오실레이터
  - 거래량 분석

### AI 기반 RAG 분석
- **한국어 특화 임베딩 모델** (jhgan/ko-sroberta-nli)
- **앙상블 검색 시스템** (BM25 + FAISS)
- **고급 LLM 모델** (Llama-3-Korean-Bllossom-8B)
- **지능형 문서 생성 시스템**
  - 일일 가격 동향 분석
  - 기술적 지표 분석
  - 거래량 분석
  - 특별 이벤트 탐지

### 인터랙티브 시각화
- **Plotly 기반 대화형 차트**
- **기술적 지표 대시보드**
- **캔들스틱 차트 + 볼린저밴드**
- **실시간 지표 모니터링**

### 대화형 분석 인터페이스
- **자연어 질문-답변 시스템**
- **예시 질문 템플릿 제공**
- **채팅 세션 관리**
- **분석 결과 저장 및 관리**

## 실행 방법


> ⚠️ **프롬프트 직접 작성 필요 안내**

이 시스템은 LLM 기반의 RAG(검색 증강 생성) 구조를 사용합니다.  
분석 프롬프트(예: "기본 분석", "20일 예측", "투자전략")는 env.json 파일에 명시적으로 정의하여 사용합니다.  
자동 생성이 아닌, 아래와 같이 프롬프트의 입력 변수와 템플릿을 직접 설계해야 합니다.

{
  "기본 분석": {
    "input_variables": ["stock_name", "query", "context", "current_date", "current_price"],
    "template": "당신은 전문 주식 투자자입니다. 주어진 정보를 바탕으로 정확하고 분석을 제공하세요.\n\n분석 대상: {stock_name}\n기준 날짜: {current_date}\n질문: {query}\n현재 주가: {current_price:,}원\n\n관련 데이터:\n{context} ......."
  }
}



```bash
streamlit run main.py
```

브라우저에서 `http://localhost:8501`로 접속하여 사용하세요.

## 📋 사용 가이드

### 1. 기본 사용법
1. **사이드바에서 종목 코드 입력** (예: 034220)
2. **데이터 기간 설정** (30-500 영업일)
3. **"데이터 로드" 버튼 클릭**
4. **각 탭에서 분석 확인**

### 2. 주요 탭 설명
- **차트 분석**: 기술적 지표 차트 및 캔들스틱 차트
- **AI 분석**: 자연어 질문-답변 기반 AI 분석
- **기술적 지표**: 상세 지표 수치 및 신호
- **데이터 상세**: 원시 데이터 및 시스템 정보

### 3. AI 분석 예시 질문
- "지금 매수하기 좋은 타이밍인가요?"
- "최근 거래량 급증의 원인은 무엇인가요?"
- "RSI가 과매수 구간에 있는데 어떻게 해석해야 하나요?"
- "볼린저 밴드 기준으로 현재 주가 위치는 어떤가요?"
- "MACD 크로스오버 신호가 있었나요?"

### 4. 샘플 종목
시스템 테스트를 위한 샘플 종목들:
- **LG디스플레이** (034220)
- **삼성전자** (005930)
- **SK하이닉스** (000660)

## 🛠️ 시스템 아키텍처

### 클래스 구조
- **ChatManager**: 채팅 세션 관리
- **TechnicalIndicators**: 기술적 지표 계산
- **StockDataManager**: 주식 데이터 수집
- **DocumentGenerator**: 분석 문서 생성
- **ModelLoader**: AI 모델 로딩
- **RAGSystem**: RAG 시스템 구축
- **ChartManager**: 차트 시각화
- **QueryProcessor**: 쿼리 처리
- **UIManager**: UI 관리

### 데이터 플로우
1. **데이터 수집** → 주식 API에서 OHLCV 데이터 수집
2. **지표 계산** → 다양한 기술적 지표 계산
3. **문서 생성** → 분석 문서 자동 생성
4. **RAG 구축** → 임베딩 및 검색 시스템 구축
5. **AI 분석** → 사용자 질문에 대한 AI 답변 생성

## 설정 옵션

### 모델 설정
- **임베딩 모델**: jhgan/ko-sroberta-nli (한국어 특화)
- **LLM 모델**: MLP-KTLim/llama-3-Korean-Bllossom-8B
- **검색 시스템**: BM25 + FAISS 앙상블 (가중치 0.5:0.5)

### 성능 최적화
- **GPU 자동 감지 및 활용**
- **모델 캐싱** (Streamlit cache_resource 활용)
- **문서 다양성 확보** (타입별 균형 선택)
- **컨텍스트 길이 제한** (최대 2500자)

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

---

**주의사항**: 이 시스템은 투자 참고용이며, 실제 투자 결정은 신중하게 하시기 바랍니다.